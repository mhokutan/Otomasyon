name: yt-auto

on:
  schedule:
    - cron: '0 6 * * *'   # her gün 06:00 UTC (TR ~09:00)
  workflow_dispatch: {}

jobs:
  build-run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install ffmpeg + fonts
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg fonts-dejavu-core

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install deps
        run: pip install -r requirements.txt

      - name: Run pipeline
        env:
          # --- TEMA / KONU ---
          THEME: crypto                     # news | crypto
          CRYPTO_COINS: bitcoin,ethereum,solana

          # --- YouTube OAuth (boşsa yükleme denemez) ---
          YT_CLIENT_ID: ""
          YT_CLIENT_SECRET: ""
          YT_REFRESH_TOKEN: ""
          YT_PRIVACY: "unlisted"

          # --- TTS (daha hızlı ve akıcı) ---
          TTS_ATEMPO: "1.35"
          TTS_GAP_MS: "30"
          TTS_BITRATE: "128k"

          # --- Görsel hareket + geçiş ---
          BG_ZOOM_PER_SEC: "0.0010"
          XFADE_SEC: "0.6"

          # --- Haber ticker (news temasında) ---
          TICKER_SPEED: "140"
          TICKER_H: "120"

          # --- Haber RSS (news temasında) ---
          RSS_URL: "https://news.google.com/rss?hl=tr&gl=TR&ceid=TR:tr"

          # (opsiyonel) HF_TOKEN: ""  # kullanmıyoruz (PIL ile görsel üretiyoruz)
          VIDEO_TITLE_PREFIX: "Günlük Özet:"
        run: |
          set -euxo pipefail
          python src/main.py
          echo "== OUT TREE =="
          ls -lah out || true

      - name: Upload artifact (video + assets)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: output
          path: |
            out/**
            **/out/**
          if-no-files-found: warn
